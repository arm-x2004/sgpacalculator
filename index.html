<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VTU ECE 2022 CGPA Calculator</title>
  <style>
    :root {
      --primary: #3f51b5;
      --accent: #e91e63;
      --light-bg: #fff;
      --dark-bg: #121212;
      --light-text: #000;
      --dark-text: #fff;
      --card-light: #fff;
      --card-dark: #1e1e1e;
    }

    /* Base styles */
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--light-bg);
      color: var(--light-text);
      transition: background-color 0.3s, color 0.3s;
      overflow-x: hidden;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    body.dark {
      background-color: var(--dark-bg);
      color: var(--dark-text);
    }

    .container {
      max-width: 1000px;
      width: 90%;
      margin: 30px auto 60px;
      flex-grow: 1;
    }

    h1#welcomeText {
      background-color: white;
      padding: 40px 30px;
      margin-top: 150px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 3.2rem;
      color: var(--primary);
      text-align: center;
      user-select: none;
      transition: color 0.3s ease;
      max-width: 600px;
      line-height: 1.2;
    }

    body.dark h1#welcomeText {
      background-color: transparent;
      color: var(--primary);
    }

    /* Semester buttons container */
    .sem-buttons {
      text-align: center;
      margin-bottom: 25px;
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition: opacity 0.6s ease, max-height 0.6s ease;
    }

    .sem-buttons.visible {
      opacity: 1;
      max-height: 200px;
      margin-top: 30px;
    }

    /* Capsule shaped buttons */
    .sem-button {
      display: inline-block;
      background-color: var(--primary);
      color: white;
      padding: 10px 20px;
      border-radius: 999px;
      border: none;
      margin: 5px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: background-color 0.3s;
      user-select: none;
    }

    .sem-button:hover {
      background-color: var(--accent);
    }

    .sem-button.active {
      background-color: var(--accent);
    }

    /* Table styles */
    .subject-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition: opacity 0.6s ease, max-height 0.6s ease;
    }

    .subject-table.visible {
      opacity: 1;
      max-height: 1000px;
    }

    .subject-table th,
    .subject-table td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
      background-color: var(--card-light);
      color: var(--light-text);
      transition: background-color 0.3s, color 0.3s;
    }

    .subject-table th:nth-child(2),
    .subject-table td:nth-child(2) {
      text-align: left;
      padding-left: 15px;
    }

    body.dark .subject-table th,
    body.dark .subject-table td {
      background-color: var(--card-dark);
      color: var(--dark-text);
    }

    .result {
      font-size: 1.4em;
      text-align: center;
      margin: 20px 0;
      font-weight: bold;
      opacity: 0;
      max-height: 0;
      transition: opacity 0.6s ease, max-height 0.6s ease;
      user-select: none;
    }

    .result.visible {
      opacity: 1;
      max-height: 100px;
    }

    /* Calculate button */
    #marksForm button[type="submit"] {
      display: block;
      margin: 0 auto;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 999px;
      padding: 12px 30px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background-color 0.3s;
      user-select: none;
    }

    #marksForm button[type="submit"]:hover {
      background-color: var(--accent);
    }

    /* Dark mode toggle button */
    .dark-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--accent);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      z-index: 2000;
      user-select: none;
    }

    /* Scroll to calculate message */
    #scrollMessage {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary);
      user-select: none;
      opacity: 1;
      transition: opacity 0.5s ease;
      z-index: 500;
    }

    body.dark #scrollMessage {
      color: var(--accent);
    }

    /* Exploding circle animation */
    #expandingCircle {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background-color: red; /* dynamically changed in JS */
      transform: translate(-50%, -50%) scale(0);
      animation: explodeCircle 0.6s forwards ease-out;
      pointer-events: none;
      user-select: none;
      opacity: 0.95;
      z-index: 1500;
      display: none;
    }

    @keyframes explodeCircle {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0.95;
      }
      100% {
        transform: translate(-50%, -50%) scale(100);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <button class="dark-toggle" onclick="toggleDarkMode()">ðŸŒ™ Toggle Dark Mode</button>

  <h1 id="welcomeText">Welcome to SGPA Calculator</h1>

  <div id="expandingCircle"></div>

  <div class="container">
    <div class="sem-buttons" id="semButtons">
      <button class="sem-button" onclick="loadSemester(1)">Sem 1</button>
      <button class="sem-button" onclick="loadSemester(2)">Sem 2</button>
      <button class="sem-button" onclick="loadSemester(3)">Sem 3</button>
      <button class="sem-button" onclick="loadSemester(4)">Sem 4</button>
      <button class="sem-button" onclick="loadSemester(5)">Sem 5</button>
      <button class="sem-button" onclick="loadSemester(6)">Sem 6</button>
      <button class="sem-button" onclick="loadSemester(7)">Sem 7</button>
      <button class="sem-button" onclick="loadSemester(8)">Sem 8</button>
    </div>

    <form id="marksForm" onsubmit="event.preventDefault(); calculateSGPA();">
      <table class="subject-table" id="subjectTable"></table>
      <div class="result" id="resultDisplay"></div>
      <button type="submit">Calculate SGPA</button>
    </form>
  </div>

  <div id="scrollMessage">Click anywhere to continue</div>

  <script>
    // Semester subjects data, only sem 1 filled, others empty
    const semesterData = {
      1: [
        { code: "21MAT11", name: "Calculus and Differential Equations", credits: 3 },
        { code: "21PHY12", name: "Engineering Physics", credits: 3 },
        { code: "21ELE13", name: "Basic Electrical Engineering", credits: 3 },
        { code: "21CIV14", name: "Elements of Civil Engineering", credits: 3 },
        { code: "21EGH15", name: "Communicative English", credits: 2 },
        { code: "21PHYL16", name: "Physics Lab", credits: 1 },
        { code: "21ELEL17", name: "Electrical Lab", credits: 1 },
        { code: "21EGH18", name: "English Lab", credits: 1 },
      ],
      2: [
        { code: "21MAT11", name: "Calculus and Differential Equations", credits: 3 },
        { code: "21PHY12", name: "Engineering Physics", credits: 3 },
        { code: "21ELE13", name: "Basic Electrical Engineering", credits: 3 },
        { code: "21CIV14", name: "Elements of Civil Engineering", credits: 3 },
        { code: "21EGH15", name: "Communicative English", credits: 2 },
        { code: "21PHYL16", name: "Physics Lab", credits: 1 },
        { code: "21ELEL17", name: "Electrical Lab", credits: 1 },
        { code: "21EGH18", name: "English Lab", credits: 1 },], 
        3: [
        { code: "21MAT11", name: "Calculus and Differential Equations", credits: 3 },
        { code: "21PHY12", name: "Engineering Physics", credits: 3 },
        { code: "21ELE13", name: "Basic Electrical Engineering", credits: 3 },
        { code: "21CIV14", name: "Elements of Civil Engineering", credits: 3 },
        { code: "21EGH15", name: "Communicative English", credits: 2 },
        { code: "21PHYL16", name: "Physics Lab", credits: 1 },
        { code: "21ELEL17", name: "Electrical Lab", credits: 1 },
        { code: "21EGH18", name: "English Lab", credits: 1 },],
        4: [
        { code: "21MAT11", name: "Calculus and Differential Equations", credits: 3 },
        { code: "21PHY12", name: "Engineering Physics", credits: 3 },
        { code: "21ELE13", name: "Basic Electrical Engineering", credits: 3 },
        { code: "21CIV14", name: "Elements of Civil Engineering", credits: 3 },
        { code: "21EGH15", name: "Communicative English", credits: 2 },
        { code: "21PHYL16", name: "Physics Lab", credits: 1 },
        { code: "21ELEL17", name: "Electrical Lab", credits: 1 },
        { code: "21EGH18", name: "English Lab", credits: 1 },], 
        5: [
        { code: "21MAT11", name: "Calculus and Differential Equations", credits: 3 },
        { code: "21PHY12", name: "Engineering Physics", credits: 3 },
        { code: "21ELE13", name: "Basic Electrical Engineering", credits: 3 },
        { code: "21CIV14", name: "Elements of Civil Engineering", credits: 3 },
        { code: "21EGH15", name: "Communicative English", credits: 2 },
        { code: "21PHYL16", name: "Physics Lab", credits: 1 },
        { code: "21ELEL17", name: "Electrical Lab", credits: 1 },
        { code: "21EGH18", name: "English Lab", credits: 1 },], 
        6: [
        { code: "21MAT11", name: "Calculus and Differential Equations", credits: 3 },
        { code: "21PHY12", name: "Engineering Physics", credits: 3 },
        { code: "21ELE13", name: "Basic Electrical Engineering", credits: 3 },
        { code: "21CIV14", name: "Elements of Civil Engineering", credits: 3 },
        { code: "21EGH15", name: "Communicative English", credits: 2 },
        { code: "21PHYL16", name: "Physics Lab", credits: 1 },
        { code: "21ELEL17", name: "Electrical Lab", credits: 1 },
        { code: "21EGH18", name: "English Lab", credits: 1 },], 
        7: [
        { code: "21MAT11", name: "Calculus and Differential Equations", credits: 3 },
        { code: "21PHY12", name: "Engineering Physics", credits: 3 },
        { code: "21ELE13", name: "Basic Electrical Engineering", credits: 3 },
        { code: "21CIV14", name: "Elements of Civil Engineering", credits: 3 },
        { code: "21EGH15", name: "Communicative English", credits: 2 },
        { code: "21PHYL16", name: "Physics Lab", credits: 1 },
        { code: "21ELEL17", name: "Electrical Lab", credits: 1 },
        { code: "21EGH18", name: "English Lab", credits: 1 },], 
        8: [
        { code: "21MAT11", name: "Calculus and Differential Equations", credits: 3 },
        { code: "21PHY12", name: "Engineering Physics", credits: 3 },
        { code: "21ELE13", name: "Basic Electrical Engineering", credits: 3 },
        { code: "21CIV14", name: "Elements of Civil Engineering", credits: 3 },
        { code: "21EGH15", name: "Communicative English", credits: 2 },
        { code: "21PHYL16", name: "Physics Lab", credits: 1 },
        { code: "21ELEL17", name: "Electrical Lab", credits: 1 },
        { code: "21EGH18", name: "English Lab", credits: 1 },]
    };

    // Grade point mapping function
    const gradePoint = (total) => {
      if (total >= 90) return 10;
      if (total >= 80) return 9;
      if (total >= 70) return 8;
      if (total >= 60) return 7;
      if (total >= 50) return 6;
      if (total >= 40) return 5;
      return 0;
    };

    // DOM elements
    const welcomeText = document.getElementById("welcomeText");
    const semButtons = document.getElementById("semButtons");
    const subjectTable = document.getElementById("subjectTable");
    const resultDisplay = document.getElementById("resultDisplay");
    const marksForm = document.getElementById("marksForm");
    const scrollMessage = document.getElementById("scrollMessage");
    const expandingCircle = document.getElementById("expandingCircle");
    const semButtonElements = document.querySelectorAll(".sem-button");

    // For managing state of welcome text & visibility
    let calcVisible = false;

    // Random colors for circle animation
    const colors = ['#e91e63', '#ff5722', '#2196f3', '#9c27b0', '#4caf50', '#f44336', '#00bcd4'];

    // Load semester subjects into table
    function loadSemester(sem) {
      // Set active button
      semButtonElements.forEach(btn => btn.classList.remove("active"));
      semButtonElements[sem - 1].classList.add("active");

      const subjects = semesterData[sem];
      if (!subjects || subjects.length === 0) {
        subjectTable.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:20px;">No data available for Semester ${sem}.</td></tr>`;
        resultDisplay.classList.remove("visible");
        subjectTable.classList.add("visible");
        return;
      }

      let html = `<thead>
        <tr>
          <th>Code</th>
          <th style="text-align:left;">Subject</th>
          <th>Credits</th>
          <th>Internal (50)</th>
          <th>External (50)</th>
          <th>Total (100)</th>
        </tr>
      </thead><tbody>`;

      subjects.forEach((sub, i) => {
        html += `<tr>
          <td>${sub.code}</td>
          <td style="text-align:left;">${sub.name}</td>
          <td>${sub.credits}</td>
          <td><input type="number" min="0" max="50" value="0" required id="internal${i}" /></td>
          <td><input type="number" min="0" max="50" value="0" required id="external${i}" /></td>
          <td id="total${i}">0</td>
        </tr>`;
      });

      html += "</tbody>";
      subjectTable.innerHTML = html;
      subjectTable.classList.add("visible");
      resultDisplay.classList.remove("visible");
    }

    // Calculate SGPA based on inputs
    function calculateSGPA() {
      const activeSemBtn = document.querySelector(".sem-button.active");
      if (!activeSemBtn) return alert("Please select a semester!");

      const sem = parseInt(activeSemBtn.textContent.replace('Sem ', ''));
      const subjects = semesterData[sem];
      if (!subjects || subjects.length === 0) return;

      let totalPoints = 0;
      let totalCredits = 0;

      for (let i = 0; i < subjects.length; i++) {
        const internalInput = document.getElementById(`internal${i}`);
        const externalInput = document.getElementById(`external${i}`);
        const totalCell = document.getElementById(`total${i}`);

        let internalMarks = parseInt(internalInput.value) || 0;
        let externalMarks = parseInt(externalInput.value) || 0;

        // Clamp values
        internalMarks = Math.min(Math.max(internalMarks, 0), 50);
        externalMarks = Math.min(Math.max(externalMarks, 0), 50);

        const totalMarks = internalMarks + externalMarks;
        totalCell.textContent = totalMarks;

        const gp = gradePoint(totalMarks);

        totalPoints += gp * subjects[i].credits;
        totalCredits += subjects[i].credits;
      }

      const sgpa = (totalPoints / totalCredits).toFixed(2);

      resultDisplay.textContent = `SGPA: ${sgpa}`;
      resultDisplay.classList.add("visible");
    }

    // Dark mode toggle
    function toggleDarkMode() {
      document.body.classList.toggle("dark");
      // Update welcome text background in light mode
      if (document.body.classList.contains("dark")) {
        welcomeText.style.backgroundColor = "transparent";
      } else {
        welcomeText.style.backgroundColor = "white";
        welcomeText.style.color = "var(--primary)";
      }
    }

    // Show semester buttons and table with animation
    function showCalculator() {
      if (calcVisible) return;
      calcVisible = true;

      // Hide scroll message
      scrollMessage.style.opacity = '0';

      // Pick random color for circle
      const color = colors[Math.floor(Math.random() * colors.length)];
      expandingCircle.style.backgroundColor = color;

      // Show circle and run animation
      expandingCircle.style.display = 'block';
      expandingCircle.style.animation = 'none'; // Reset animation
      void expandingCircle.offsetWidth; // Trigger reflow
      expandingCircle.style.animation = 'explodeCircle 0.6s forwards ease-out';

      // Change welcome text color to white during animation
      welcomeText.style.color = 'white';

      // After animation ends (~600ms), show buttons and table
      setTimeout(() => {
        expandingCircle.style.display = 'none';
        semButtons.classList.add("visible");
        loadSemester(1);
        marksForm.querySelector("button[type=submit]").style.display = 'inline-block';
      }, 600);
    }

    // Detect scroll or click anywhere on page to trigger calculator
    let scrollOrClickDetected = false;
    function onScrollOrClick() {
      if (!scrollOrClickDetected) {
        scrollOrClickDetected = true;
        showCalculator();
      }
    }

    window.addEventListener('scroll', onScrollOrClick);
    window.addEventListener('click', onScrollOrClick);
    window.addEventListener('touchstart', onScrollOrClick);

    // Initial setup: welcome text background for light mode
    if (!document.body.classList.contains("dark")) {
      welcomeText.style.backgroundColor = "white";
      welcomeText.style.color = "var(--primary)";
    }

    // Initially hide submit button (show only after calc visible)
    marksForm.querySelector("button[type=submit]").style.display = 'none';

    // Set sem 1 button active by default for accessibility
    semButtonElements[0].classList.add("active");
  </script>
</body>
</html>
